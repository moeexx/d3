<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>地图</title>
    <script src="js/d3.v4.min.js"></script>
    <script src="js/queue.v1.min.js"></script>
    <script src="js/topojson.v3.min.js"></script>
    <script src="js/d3-geo-projection.v2.min.js"></script>
</head>
    <svg id="gdp"></svg>
<body>
    <script>

        const width = 960;
        const height = 500;
        const svg = d3.select('#gdp')
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('class', 'map');
        const projection = d3.geoMercator()
            .scale(148)
            .rotate([352, 0, 0])
            .translate( [width / 2, height / 1.5]);
        const path = d3.geoPath().projection(projection);

        //加载地图
        queue()
            .defer(d3.json, './data/world_countries.json')
            .defer(d3.json, './data/data.json')
            .await(ready);

        function ready(error, maps, gdp) {

            // console.log(maps)

            const country = [];
            gdp.forEach(element => {
                if((country.indexOf(element.country)==-1)){
                    country.push(element.country);
                }
            });
            console.log(country)

            var year_data = {};
            country.forEach(e => {
                var country = [];
                gdp.forEach(d => {
                    if(d.country == e){
                        country.push(d)
                    }
                });
                year_data[e] = country
            })

            console.log(year_data)
   
            svg.append('g')
                .attr('class', 'countries')
                .selectAll('path')
                .data(maps.features)
                .enter().append('path')
                .attr('d', path)
                .style('fill', '#ECEFF1')
                .style('stroke', '#607D8B')
                .style('stroke-width', 0.8)
                .on('mouseover',function(d){
                    // console.log(d.properties.name)
                    d3.select(this)
                        .style('stroke-width', 2)
                })
                .on('mouseout', function(d){
                    d3.select(this)
                        .style('stroke-width', 0.8)
                });

        }
    </script>
</body>
</html>